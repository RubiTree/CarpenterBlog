
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>
    
  eifjei - CarpenterBlog
  

  </title>
  <meta name="author" content="">
  <meta name="description" content="">

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link href="asset/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="atom.xml" rel="alternate" title="CarpenterBlog" type="application/atom+xml">
  <script src="asset/js/modernizr-2.0.js"></script>
  <script src="asset/js/jquery.min.js"></script>
  <script src="asset/highlightjs/highlight.pack.js"></script>
  <link href="asset/highlightjs/styles/solarized_light.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script>hljs.initHighlightingOnLoad();</script>

  <style type="text/css">
  .cat-children-p{ padding: 6px 0px;}
  .hljs{background: none;}
  </style>
  <script type="text/javascript">
  var isAddSildbar = true;
  </script>
  <script src="asset/js/octopress.js" type="text/javascript"></script>
</head>
<script type="text/javascript">
//链接新开窗口
function addBlankTargetForLinks () {
  $('a[href^="http"]').each(function(){
      $(this).attr('target', '_blank');
  });
}
$(document).ready(function(event) {
  addBlankTargetForLinks();
});
</script>
<body   >
  <header role="banner"><hgroup>
  <h1><a href="index.html">CarpenterBlog</a></h1>
  
    <h2></h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:blog.zhengyu.site" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">

  <li id=""><a target="self" href="index.html">Home</a></li>

  <li id=""><a target="_self" href="archives.html">Archives</a></li>

</ul>

</nav>
  <div id="main">
    <div id="content"> 
<div>
	<article class="hentry" role="article">
	<header>
			  	<h1 class="entry-title">eifjei</h1>
				<p class="meta"><time datetime="2018-12-21T03:22:12+08:00" pubdate data-updated="true">2018/12/21</time></p>
			 </header>
		  	<div class="entry-content">
			  	<!--<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'mweb-en';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

-->

<div id="disqus_thread"></div>

<script>


var disqus_config = function () {
this.page.url = `http://blog.zhengyu.site/`;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = `http://blog.zhengyu.site/`; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://http-blog-zhengyu-site.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

<div id="disqus_thread"></div>

<script type="text/javascript">
var disqus_shortname = 'http-blog-zhengyu-site'; 

   (function() {
       var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
       dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
       (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
   })();
</script>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

<ol>
<li>canvas的操作是使用相对坐标系</li>
<li><p>如何通过相对坐标系的API来实现绝对坐标系的效果？</p>

<ol>
<li>那就是当成绝对坐标系的API来用，但是操作的顺序反过来写，只要基于一个单位阵变换，那么结果就跟调用绝对坐标系的API的效果是一样的，相当于手动前乘</li>
</ol></li>
<li><p><code>Canvas</code>变换是我们日常开发自定义控件用得比较多的东西，我们知道<code>Canvas</code>有这些变换操作：平移、缩放、旋转、错切，对<code>Canvas</code>进行变换后，再在<code>Canvas</code>上进行绘制，绘制出的图形就能体现出刚才变换的效果</p>

<ol>
<li>比如往 \(X\) 轴和 \(Y\) 轴的正方向平移100像素：</li>
<li>\(canvas.translate(100f, 100f) \\  canvas.drawBitmap(image)\)</li>
<li>（下图中每一个小方格间距50像素，每两个小方格间有一个刻度，代表100像素）</li>
<li><img src="media/15444051477462/15449657481603.gif" alt=""/></li>
</ol></li>
<li><p>但在我们要实现一些稍微复杂的连续变换时，比如不使用带偏移中心的API，把图形绕<code>(200, 200)</code>顺时针旋转90度；或是使用<code>Camera</code>进行连续变换以实现绕图片的中线翻转；或者其他更复杂的需求时，你会发现按照正常思路，往往无法得到你想要的效果</p></li>
<li><p>于是你可能会被告知：当成代码是倒着执行的，你先正着写，再把操作顺序倒过来，就能实现你的需求了。但是这样为什么能实现需求？为什么代码是倒着执行的？正着倒着是相对什么来的，为什么正着我也能写出好几种变换顺序？为什么有的时候这个方法不顶用？这些问题你可能都不清楚</p></li>
<li><p>然后你可能也听说过，对<code>Canvas</code>进行变换还可以通过操作<code>matrix</code>实现，但是具体怎么做，它的<code>pre</code>和<code>post</code>操作到底代表了什么意思，你可能不是很明白</p></li>
<li><p>最后你可能还知道可以通过<code>Camera</code>进行三维变换，但是变换的效果往往出乎你的预料</p></li>
<li><p>所以本文的目标就是要把这些问题分析清楚，让你真正理解<code>Canvas</code>变换究竟是怎么运作的，以及为什么这么运作 &lt;!--。如果你确定对于这些问题你都理解得非常清楚，那看到这就该干嘛干嘛去吧~--&gt;</p></li>
</ol>

<p>其他问题</p>

<ol>
<li>发现再复杂的效果（比如在(200,200)处，旋转45度，缩小3倍），都可以通过使用canvas的API，使用相对坐标系法，轻松地做到

<ol>
<li>一个通用套路就是：先移动，后进行原地旋转或缩放操作，就OK了</li>
<li>但是如果修改旋转或缩放中心，就不知道是不是也是这样（@@@？）</li>
<li>为什么选择或缩放操作的顺序可以交换，好像绝对相对都是这样，是不是可以从公式得到？（中间不能插入移动）（@@@？）</li>
</ol></li>
<li>除非是有需要两轮或多轮操作的场景，第二轮的所有操作都要考虑第一轮的结果，这时候就会比较难算了

<ol>
<li>但主要难算的第一下的移动，旋转和缩放都比较好算</li>
<li>而且发现其实没有多轮操作的场景，你完全可以通过两次从原点的操作实现效果</li>
<li>但你可以强行有，比如我就是要演示一个动画，从效果1到效果2，那就最好做相对操作了</li>
</ol></li>
<li>一个非常疑惑的问题：扔物线说，你可以按照相反的顺序写

<ol>
<li>其实不管是相对操作还是绝对操作，你都可以用不同的顺序操作（不同的顺序，也会让操作的参数不同），得到同样的效果，所以扔物线说，你可以按照相反的顺序写，什么叫相反的顺序，什么又是正的顺序呢？</li>
<li>答案是，只要你按照绝对坐标系的思路写，不管什么操作顺序，只要倒过来写，就都会是对的效果，正着写，都不对</li>
</ol></li>
<li>最后的问题，为什么绝对坐标系没有中心的说法，但你把相对坐标系有中心的API当成绝对的写，有中心，为什么也是生效的，什么是中心，它是怎么实现的，相对绝对里的中心有什么区别？

<ol>
<li>想一下，绝对坐标系的绕中心操作要怎么实现

<ol>
<li>比如绕中心旋转，postMove(-rotateX,-rotateY) -&gt; postRotate() -&gt; postMove(rotateX,rotateY)，极其简单（cur是旋转点在绝对坐标系上的坐标）</li>
<li>也可以给出旋转点在相对坐标系上的坐标，你就得算出在绝对坐标系上是多少</li>
</ol></li>
<li>想一下，相对坐标系的绕中心操作要怎么实现

<ol>
<li>比如绕中心旋转，其实相对坐标系也是矩阵操作，如果。。。</li>
<li>其实用相对坐标系的本质是，用pre操作实现同样的效果</li>
<li>所以有一个A，你要用后乘实现MRM-1*A的效果，好像没法做很简单地做，除非A是单位阵，但好像系统API实现了啊</li>
<li>得看一下相对操作提供的元操作是什么（@@@？需要看吗？不就跟绝对是一样的吗？）</li>
<li>一般这时给出的旋转点是相对坐标系上的坐标</li>
<li>比如我就是要绕相对的0点转，那直接转就行，如果要绕相对的（100，100）转，我曹，完全不会操作</li>
<li>其实绕某点旋转，旋转的效果是体现在绝对坐标系上的，相对坐标系其实相对自己，感受不到任何变换。所以其实前乘和后乘的区别，不是参考绝对坐标系还是参考相对坐标系，都是参考绝对坐标系，区别是变换是后面的变换参考前面的变换被改变，还是后面的变化直接改变前面的变换</li>
<li>所以，就是把相对坐标系的原点移动到旋转点，开始旋转，然后移动回去，这个移动回去完全可以被前面操作影响</li>
<li>所以操作是：preMove(rotateX,rotateY) -&gt; preRotate() -&gt; preMove(-rotateX,-rotateY)（跟上面的rotate值不一样）</li>
<li>诶，这真的可以吗，为什么我前面觉得毫无办法</li>
<li>这里的一个关键动作是：「把相对坐标系的原点移动到旋转点」，这步是灵机一动，但为什么有效，需要证明一下，或者用公式推导一下。用纸法设想一下，发现能理解，但确实需要一些几何的理解，不太直观</li>
</ol></li>
<li>有两页公式推导（@@@？！这里要集中写），很清晰</li>
<li>（@@@？这里还有一开始在探索相对的两种写法留下的问题，当时的想法太简单，没有证明出来，现在可以看一下）</li>
</ol></li>
<li>其实整个操作都是在绝对坐标系中变换一个相对坐标系，操作的是一个坐标</li>
</ol>

			</div>

		
	  
		<footer>
		 <p class="meta">

			
			<span class="categories">
			 
			</span>
		    </p>
		    <p class="meta">
		      
		 </p>
	    
		<div class="sharing">
		  <div id="disqus_thread"></div>
<script type="text/javascript">
var disqus_shortname = 'http-blog-zhengyu-site'; 

   (function() {
       var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
       dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
       (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
   })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          

          

		</div>

	    <p class="meta">
	    
	    
	    </p>
	  </footer>
	</article>
</div>
 <aside class="sidebar"> 

	<section>
	  <h1>Categories</h1>
	  <ul id="recent_posts">
	  
	        
	      </li>
	   
	  </ul>
	</section>
	<section>
	  <h1>Recent Posts</h1>
	  <ul id="recent_posts">
	  
	      
		      <li class="post">
		        <a href="15453337323289.html">eifjei</a>
		      </li>
	     
	   
	  </ul>
	</section>
	
</aside> </div></div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 -  -
  <span class="credit">Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a> &nbsp;&nbsp; Theme by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>

  
    


<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({TeX: { equationNumbers: { autoNumber: "AMS" } }});</script>

</body>
</html>